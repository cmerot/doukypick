<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>G√©n√©rateur QR Code avec Logo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        opacity: 0.9;
        font-size: 1.1rem;
      }

      .main {
        padding: 40px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
      }

      .form-section {
        display: flex;
        flex-direction: column;
        gap: 25px;
      }

      .input-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      label {
        font-weight: 600;
        color: #333;
        font-size: 0.95rem;
      }

      input,
      select {
        padding: 12px 16px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .color-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .color-input {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      input[type="color"] {
        width: 50px;
        height: 40px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }

      .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
        width: 100%;
      }

      .file-input-wrapper input[type="file"] {
        position: absolute;
        left: -9999px;
      }

      .file-input-label {
        display: block;
        padding: 12px 16px;
        border: 2px dashed #667eea;
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background: #f8f9ff;
      }

      .file-input-label:hover {
        background: #f0f2ff;
        border-color: #5a67d8;
      }

      .generate-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .generate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      }

      .result-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }

      .qr-container {
        position: relative;
        display: inline-block;
        padding: 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }

      #qrcode {
        display: block;
      }

      .download-btn {
        background: #10b981;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .download-btn:hover {
        background: #059669;
        transform: translateY(-1px);
      }

      .preview-logo {
        max-width: 100px;
        max-height: 100px;
        margin-top: 10px;
        border-radius: 8px;
        border: 2px solid #e1e5e9;
      }

      @media (max-width: 768px) {
        .main {
          grid-template-columns: 1fr;
          gap: 30px;
        }

        .header h1 {
          font-size: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üé® G√©n√©rateur QR Code</h1>
        <p>Cr√©ez des QR codes personnalis√©s avec logo et couleurs</p>
      </div>

      <div class="main">
        <div class="form-section">
          <div class="input-group">
            <label for="url">URL du site web</label>
            <input
              type="url"
              id="url"
              placeholder="https://example.com"
              required
            />
          </div>

          <div class="color-group">
            <div class="input-group">
              <label>Couleur du QR Code</label>
              <div class="color-input">
                <input type="color" id="darkColor" value="#000000" />
                <span>Fonc√©</span>
              </div>
            </div>
            <div class="input-group">
              <label>Couleur d'arri√®re-plan</label>
              <div class="color-input">
                <input type="color" id="lightColor" value="#ffffff" />
                <span>Clair</span>
              </div>
            </div>
          </div>

          <div class="input-group">
            <label for="size">Taille (pixels)</label>
            <select id="size">
              <option value="200">200x200</option>
              <option value="300" selected>300x300</option>
              <option value="400">400x400</option>
              <option value="500">500x500</option>
            </select>
          </div>

          <div class="input-group">
            <label for="style">Style du QR Code</label>
            <select id="style">
              <option value="square">Carr√©s classiques</option>
              <option value="rounded" selected>Coins arrondis</option>
              <option value="dots">Points ronds</option>
              <option value="extra-rounded">Tr√®s arrondis</option>
            </select>
          </div>

          <div class="input-group">
            <label>Logo (optionnel)</label>
            <div class="file-input-wrapper">
              <input type="file" id="logoFile" accept="image/*" />
              <label for="logoFile" class="file-input-label">
                üìÅ Choisir un logo
              </label>
            </div>
            <img id="logoPreview" class="preview-logo" style="display: none" />
          </div>

          <button class="generate-btn" onclick="generateQR()">
            ‚ú® G√©n√©rer le QR Code
          </button>
        </div>

        <div class="result-section">
          <div class="qr-container">
            <canvas id="qrcode"></canvas>
          </div>
          <button
            class="download-btn"
            onclick="downloadQR()"
            style="display: none"
          >
            üíæ T√©l√©charger
          </button>
        </div>
      </div>
    </div>

    <script>
      let currentLogo = null;

      document
        .getElementById("logoFile")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              currentLogo = e.target.result;
              const preview = document.getElementById("logoPreview");
              preview.src = currentLogo;
              preview.style.display = "block";
            };
            reader.readAsDataURL(file);
          }
        });

      function generateQR() {
        const url = document.getElementById("url").value;
        const darkColor = document.getElementById("darkColor").value;
        const lightColor = document.getElementById("lightColor").value;
        const size = parseInt(document.getElementById("size").value);
        const style = document.getElementById("style").value;

        if (!url) {
          alert("Veuillez entrer une URL");
          return;
        }

        const canvas = document.getElementById("qrcode");

        try {
          // G√©n√©rer le QR code de base avec QRious
          const qr = new QRious({
            element: canvas,
            value: url,
            size: size,
            foreground: darkColor,
            background: lightColor,
            level: "H",
          });

          // Appliquer le style personnalis√©
          if (style !== "square") {
            setTimeout(() => {
              applyCustomStyle(canvas, size, darkColor, lightColor, style);

              // Ajouter le logo apr√®s le style
              if (currentLogo) {
                setTimeout(() => addLogoToCanvas(canvas, size), 50);
              }
            }, 50);
          } else if (currentLogo) {
            // Pour le style carr√©, juste ajouter le logo
            setTimeout(() => addLogoToCanvas(canvas, size), 50);
          }

          document.querySelector(".download-btn").style.display = "block";
        } catch (error) {
          alert("Erreur lors de la g√©n√©ration du QR code: " + error.message);
        }
      }

      function applyCustomStyle(canvas, size, darkColor, lightColor, style) {
        const ctx = canvas.getContext("2d");
        const imageData = ctx.getImageData(0, 0, size, size);
        const data = imageData.data;

        // Cr√©er un canvas temporaire
        const tempCanvas = document.createElement("canvas");
        tempCanvas.width = size;
        tempCanvas.height = size;
        const tempCtx = tempCanvas.getContext("2d");

        // Fond
        tempCtx.fillStyle = lightColor;
        tempCtx.fillRect(0, 0, size, size);
        tempCtx.fillStyle = darkColor;

        // D√©tecter la taille des modules
        let moduleSize = 0;
        let modules = 0;

        // Scanner pour trouver la taille d'un module
        for (let i = 0; i < size; i++) {
          const index = i * 4;
          const isDark = data[index] < 128;
          if (i > 0) {
            const prevIndex = (i - 1) * 4;
            const wasDark = data[prevIndex] < 128;
            if (isDark !== wasDark) {
              moduleSize = i;
              break;
            }
          }
        }

        if (moduleSize === 0) moduleSize = Math.floor(size / 33);
        modules = Math.floor(size / moduleSize);

        // Cr√©er la carte des modules
        const moduleMap = [];
        for (let y = 0; y < modules; y++) {
          moduleMap[y] = [];
          for (let x = 0; x < modules; x++) {
            const px = Math.floor(x * moduleSize + moduleSize / 2);
            const py = Math.floor(y * moduleSize + moduleSize / 2);
            const index = (py * size + px) * 4;
            moduleMap[y][x] = data[index] < 128;
          }
        }

        // Dessiner avec le style choisi
        for (let y = 0; y < modules; y++) {
          for (let x = 0; x < modules; x++) {
            if (moduleMap[y][x]) {
              const px = x * moduleSize;
              const py = y * moduleSize;

              // V√©rifier si c'est un carr√© de positionnement
              const isTopLeft = x < 7 && y < 7;
              const isTopRight = x >= modules - 7 && y < 7;
              const isBottomLeft = x < 7 && y >= modules - 7;
              const isPositionSquare = isTopLeft || isTopRight || isBottomLeft;

              if (isPositionSquare) {
                drawPositionModule(
                  tempCtx,
                  x,
                  y,
                  px,
                  py,
                  moduleSize,
                  modules,
                  style,
                  isTopLeft,
                  isTopRight,
                  isBottomLeft
                );
              } else {
                drawModule(tempCtx, px, py, moduleSize, style);
              }
            }
          }
        }

        // Copier sur le canvas original
        ctx.clearRect(0, 0, size, size);
        ctx.drawImage(tempCanvas, 0, 0);
      }

      function drawPositionModule(
        ctx,
        x,
        y,
        px,
        py,
        moduleSize,
        modules,
        style,
        isTopLeft,
        isTopRight,
        isBottomLeft
      ) {
        let cornerX = 0;
        let cornerY = 0;

        if (isTopRight) cornerX = modules - 7;
        if (isBottomLeft) cornerY = modules - 7;

        const relX = x - cornerX;
        const relY = y - cornerY;

        // Structure 7x7: bordure ext√©rieure et carr√© int√©rieur 3x3
        const isOuterBorder =
          relX === 0 || relX === 6 || relY === 0 || relY === 6;
        const isInnerSquare = relX >= 2 && relX <= 4 && relY >= 2 && relY <= 4;

        if (isOuterBorder || isInnerSquare) {
          if (style === "rounded") {
            ctx.beginPath();
            roundRect(ctx, px, py, moduleSize, moduleSize, moduleSize * 0.3);
            ctx.fill();
          } else if (style === "extra-rounded") {
            ctx.beginPath();
            roundRect(ctx, px, py, moduleSize, moduleSize, moduleSize * 0.45);
            ctx.fill();
          } else if (style === "dots") {
            ctx.beginPath();
            ctx.arc(
              px + moduleSize / 2,
              py + moduleSize / 2,
              moduleSize / 2.2,
              0,
              Math.PI * 2
            );
            ctx.fill();
          } else {
            ctx.fillRect(px, py, moduleSize, moduleSize);
          }
        }
      }

      function drawModule(ctx, px, py, moduleSize, style) {
        if (style === "rounded") {
          ctx.beginPath();
          roundRect(ctx, px, py, moduleSize, moduleSize, moduleSize * 0.3);
          ctx.fill();
        } else if (style === "extra-rounded") {
          ctx.beginPath();
          roundRect(ctx, px, py, moduleSize, moduleSize, moduleSize * 0.45);
          ctx.fill();
        } else if (style === "dots") {
          ctx.beginPath();
          ctx.arc(
            px + moduleSize / 2,
            py + moduleSize / 2,
            moduleSize / 2.2,
            0,
            Math.PI * 2
          );
          ctx.fill();
        } else {
          ctx.fillRect(px, py, moduleSize, moduleSize);
        }
      }

      function roundRect(ctx, x, y, width, height, radius) {
        ctx.moveTo(x + radius, y);
        ctx.lineTo(x + width - radius, y);
        ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
        ctx.lineTo(x + width, y + height - radius);
        ctx.quadraticCurveTo(
          x + width,
          y + height,
          x + width - radius,
          y + height
        );
        ctx.lineTo(x + radius, y + height);
        ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
        ctx.lineTo(x, y + radius);
        ctx.quadraticCurveTo(x, y, x + radius, y);
        ctx.closePath();
      }

      function addLogoToCanvas(canvas, size) {
        const ctx = canvas.getContext("2d");
        const logoImg = new Image();
        logoImg.onload = function () {
          const logoSize = size * 0.15;
          const x = (size - logoSize) / 2;
          const y = (size - logoSize) / 2;

          // Fond blanc arrondi pour le logo
          ctx.fillStyle = "white";
          ctx.beginPath();
          roundRect(ctx, x - 8, y - 8, logoSize + 16, logoSize + 16, 8);
          ctx.fill();

          // Bordure l√©g√®re
          ctx.strokeStyle = "#e1e5e9";
          ctx.lineWidth = 2;
          ctx.stroke();

          // Dessiner le logo
          ctx.drawImage(logoImg, x, y, logoSize, logoSize);
        };
        logoImg.src = currentLogo;
      }

      function downloadQR() {
        const canvas = document.getElementById("qrcode");
        const link = document.createElement("a");
        link.download = "qrcode.png";
        link.href = canvas.toDataURL();
        link.click();
      }

      // G√©n√©rer un QR code d'exemple au chargement
      window.onload = function () {
        document.getElementById("url").value = "https://example.com";
        generateQR();
      };
    </script>
  </body>
</html>
